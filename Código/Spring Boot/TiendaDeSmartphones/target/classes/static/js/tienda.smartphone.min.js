var datatables_spanish = {
    "sProcessing": "Procesando...",
    "sLengthMenu": "Mostrar _MENU_ registros",
    "sZeroRecords": "No se encontraron resultados",
    "sEmptyTable": "Ningún dato disponible en esta tabla",
    "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
    "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
    "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
    "sInfoPostFix": "",
    "sSearch": "Buscar:",
    "sUrl": "",
    "sInfoThousands": ",",
    "sLoadingRecords": "Cargando...",
    "oPaginate": {
        "sFirst": "Primero",
        "sLast": "Último",
        "sNext": "Siguiente",
        "sPrevious": "Anterior"
    },
    "oAria": {
        "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
        "sSortDescending": ": Activar para ordenar la columna de manera descendente"
    }
};

var opciones = function (id) {
    return '<td>' +
        '<button id=' + id + ' type="button" class="btn btn-primary glyphicon glyphicon glyphicon-shopping-cart" data-toggle="tooltip" data-placement="top" title="Vender"></button> ' +
        '<button id=' + id + ' type="button" class="btn btn-success glyphicon glyphicon-edit" data-toggle="tooltip" data-placement="top" title="Editar"></button> ' +
        '<button id=' + id + ' type="button" class="btn btn-warning glyphicon glyphicon-transfer" data-toggle="tooltip" data-placement="top" title="Traspaso"></button> ' +
        '<button id=' + id + ' type="button" class="btn btn-danger glyphicon glyphicon-trash" data-toggle="tooltip" data-placement="top" title="Eliminar"></button>' +
        '</td>';
}
$(document).ready(function () {

    $.get("/smartphone/lista", function (data) {
        for (i = 0; i < data.length; i++) {
            $("#tDatos").append('<tr>' +
                '<td>' + data[i].marca + '</td>' +
                '<td>' + data[i].modelo + '</td>' +
                '<td>' + data[i].descripcion + '</td>' +
                '<td>' + data[i].color + '</td>' +
                '<td>' + data[i].precio + '</td>' +
                '<td>' + data[i].cantidad + '</td>' +
                opciones(data[i].idSmartphone) +
                '</tr>');
        }
        var tabla = $("#tablaSmartphones").DataTable({
                'language': datatables_spanish,
                'aoColumnDefs': [{'bSortable': false, 'aTargets': [6]}]
            });
        modificarSmartphone("#tablaSmartphones", tabla);
        $('[data-toggle="tooltip"]').tooltip();
    });


    var modificarSmartphone = function (tbody, table) {
        $(tbody).on("click", ".btn-success", function () {
            var datos = table.row($(this).parents("tr")).data();
            $("#modalTitulo").html("Actualizar Smartphone");
            $("#btnGuardar").html("Actualizar");
            $("#inputMarca").val(datos[0]);
            $("#inputModelo").val(datos[1]);
            $("#inputDescripcion").val(datos[2]);
            $("#inputColor").val(datos[3]);
            $("#inputPrecio").val(datos[4]);
            $("#inputCantidad").val(datos[5]);
            $("#inputID").val($(this).attr("id"));
            $("#modalRegistro").modal("show");
        });
    }

    $("#btnAgregar").click(function () {
        $("#modalTitulo").html("Registrar Smartphone");
        $("#btnGuardar").html("Agregar");
        $("#inputMarca").val("");
        $("#inputModelo").val("");
        $("#inputDescripcion").val("");
        $("#inputColor").val("");
        $("#inputPrecio").val("");
        $("#inputCantidad").val("");
        $("#inputID").val(null);
        $("#modalRegistro").modal("show");
    });

    $("#btnGuardar").click(function () {
        var marca = $("#inputMarca").val();
        var modelo = $("#inputModelo").val();
        var descripicion = $("#inputDescripcion").val();
        var color = $("#inputColor").val();
        var precio = $("#inputPrecio").val();
        var cantidad = $("#inputCantidad").val();
        var id = $("#inputID").val();

        if (marca == "" || modelo == "" || descripicion == "" || color == "" || precio == "" || cantidad == "") {
            swal("Advertencia", "Por favor llene todos los campos", "error");
        } else {
            var smartphone = {
                "idSmartphone": id,
                "marca": marca,
                "modelo": modelo,
                "descripcion": descripicion,
                "color": color,
                "precio": precio,
                "cantidad": cantidad
            };

            $.ajax({
                url: '/smartphone/guardar',
                data: JSON.stringify(smartphone),
                type: "POST",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Accept", "application/json");
                    xhr.setRequestHeader("Content-Type", "application/json");
                },
                success: function () {
                    if (id==""){
                        swal("¡Éxito!","Se ha agregado un nuevo smartphone","success");
                    }else{
                        swal("¡Éxito!","Se ha actualizado el smartphone","success");
                    }
                    location.reload();
                    $("#modalRegistro").modal("hide");
                },
                error:function () {
                    swal("Error","Ha ocurrido un error, intente está operación más tarde","error");
                }
            });
        }
    });
});
